#!/bin/bash

# Install the vim and cppenviron.
#
# * Need tools:
#       wget
#       dos2unix
#
# * It's contains software:
#       git
#       g++ supports -std=c++11
#       vim 7.4.2367
#       ctags
#       python
#       python-dev
#       ruby
#       ruby-dev
#
# * Vim plugins:
#       vim-YouCompleteMe
#       vim-vundle
#       vim-airline
#       vim-nerdtree
#       vim-taglist
#       vim-cppenv.
#
# * And contains config files:
#       _vimrc
#       .ycm_extra_conf.py
#

# install dos2unix, git, vim, g++, ctags, cmake, python-dev

. ./lib/lib.sh

set -e

workdir=`pwd`
isMac=`uname -a | grep Darwin -c || echo -n`
if [ "$isMac" == '1' ]
then
    brew --version || /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew update
    wget --version || brew install wget
    dos2unix --version || brew install dos2unix
    echo 'MacOS brew installed OK'
fi

# config git address
VUNDLE_GIT=https://gitee.com/yyzybb537/Vundle.vim.git
YCM_GIT=https://gitee.com/yyzybb537/YouCompleteMe.git

# install tools
cd tools
./gcc.sh
./git.sh
./ctags.sh
#./mlocate.sh

if [ "$isMac" == "0" ]; then
    ./libncurses.sh
    ./python.sh
    ./ruby.sh
    ./vim.sh
fi
cd -

# copy _vimrc and .ycm_extra_conf to $HOME
dos2unix _vimrc
rm $HOME/_vimrc -f
ln _vimrc $HOME/_vimrc || cp _vimrc $HOME/_vimrc
chmod 0666 $HOME/_vimrc
dos2unix .ycm_extra_conf.py
rm $HOME/.ycm_extra_conf.py -f
cp .ycm_extra_conf.py $HOME/
chmod 0666 $HOME/.ycm_extra_conf.py
vim_exe=`which vim`
vim_exe_dir=`dirname $vim_exe`
mkdir -p $HOME/bin
rm $HOME/bin/v -f
ln -s ${vim_exe_dir}/vim $HOME/bin/v || echo ''

# git clone vim-vundle.git
vim_path=$HOME/.vim
vundle_path=${vim_path}/vimfiles/bundle/Vundle.vim
git_clone ${VUNDLE_GIT} ${vundle_path}

# compile YouCompleteMe
ycm_path=${vim_path}/vimfiles/bundle/YouCompleteMe
git_clone ${YCM_GIT} ${ycm_path}
cd ${ycm_path}
./install.py --go-completer

# install other's vim-plugins
vim +BundleInstall -c quitall

echo 'vim-go-env is ok, good luck!'

